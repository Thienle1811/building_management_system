{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Quản lý Hóa đơn (Tháng {{ current_month }}/{{ current_year }})</h2>
        <a href="{% url 'admin:billing_invoice_changelist' %}" class="btn btn-secondary">
            <i class="fas fa-cog"></i> Chạy Action Tạo Hóa đơn
        </a>
    </div>

    {% include 'includes/messages.html' %} 

    <div class="row mb-3">
        <form method="get" class="d-flex align-items-center">
            <select name="status" class="form-select me-2">
                <option value="">-- Lọc theo Trạng thái --</option>
                {% for code, display in status_choices %}
                    <option value="{{ code }}" {% if code == active_status %}selected{% endif %}>{{ display }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Lọc</button>
        </form>
    </div>

    <table class="table table-hover table-striped">
        <thead>
            <tr>
                <th>Mã HĐ</th>
                <th>Căn hộ</th>
                <th>Kỳ Hạn</th>
                <th>Tổng tiền</th>
                <th>Trạng thái</th>
                <th>Ảnh UNC</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in invoices %}
            <tr class="{% if invoice.status == 'PAID' %}table-success{% elif invoice.status == 'OVERDUE' %}table-danger{% elif invoice.status == 'PENDING' %}table-warning{% endif %}">
                <td><a href="{% url 'billing:invoice_detail' pk=invoice.pk %}">{{ invoice.code }}</a></td>
                <td>{{ invoice.apartment.apartment_code }}</td>
                <td>T{{ invoice.month }}/{{ invoice.year }}</td>
                <td>{{ invoice.total_amount|intcomma }} đ</td>
                <td>{{ invoice.get_status_display }}</td>
                <td>
                    {% if invoice.payment_proof %}
                        <span class="badge bg-success">Có</span>
                    {% else %}
                        <span class="badge bg-secondary">Không</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'billing:invoice_detail' pk=invoice.pk %}" class="btn btn-sm btn-info">Xem chi tiết</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">Chưa có hóa đơn nào được tạo trong hệ thống.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock content %}